var LCB;(()=>{"use strict";var t={97:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{u(i.next(t))}catch(t){a(t)}}function c(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=c(0),r.throw=c(1),r.return=c(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(a=0)),a;)try{if(n=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],i=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseHelper=void 0;var a=n(842),r=function(){function t(){}return t.prototype.getButtonLocation=function(t){t&&("object"==typeof t.data?(this.formContext=t,this.containerType="form"):"function"==typeof t.getGrid&&(this.gridControl=t,"function"==typeof this.gridControl.getParent&&null!==this.gridControl.getParent()?this.containerType="subgrid":this.containerType="grid"))},t.prototype.getLanguageCode=function(){return Xrm.Utility.getGlobalContext().userSettings.languageId},t.prototype.getUserID=function(){return Xrm.Utility.getGlobalContext().userSettings.userId.replace("{","").replace("}","").toLowerCase()},t.prototype.getEntityPluralName=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,Xrm.Utility.getEntityMetadata(t)];case 1:return[2,e.sent().EntitySetName]}}))}))},t.prototype.makeRequest=function(t,e,n){return i(this,void 0,void 0,(function(){var i;return o(this,(function(o){return i={method:t,headers:{"Content-Type":"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0",Accept:"application/json",Prefer:"odata.include-annotations=*"},body:n?JSON.stringify(n):void 0},[2,fetch(e,i)]}))}))},t.prototype.getButtonSetting=function(t){return i(this,void 0,void 0,(function(){var e,n,i,r,c;return o(this,(function(o){switch(o.label){case 0:e='\n      <fetch top="1">\n        <entity name="esp_buttonsetting">\n          <attribute name="esp_buttonsettingid" />\n          <attribute name="esp_buttonlocation" />\n          <attribute name="esp_endpoint" />\n          <attribute name="esp_includecallinguseridinpayload" />\n          <attribute name="esp_includeentitylogicalnameinpayload" />\n          <attribute name="esp_includerecordidinpayload" />\n          <attribute name="esp_buttonname" />\n          <attribute name="esp_savebeforerunning" />\n          <attribute name="esp_refreshwhenapicallends" />\n          <filter type="and">\n            <condition attribute="esp_buttonname" operator="eq" value="'.concat(t,'" />\n          </filter>\n        </entity>\n      </fetch>\n    '),n="?fetchXml=".concat(encodeURIComponent(e)),i="".concat(Xrm.Utility.getGlobalContext().getClientUrl(),"/api/data/v9.1/esp_buttonsettings").concat(n),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.makeRequest("GET",i)];case 2:return[4,o.sent().json()];case 3:return r=o.sent(),c=r.value[0],this.buttonSetting=c,[2,c];case 4:return o.sent(),a.ExceptionLowCodeButton.buttonSettingNotFound(t),[2,null];case 5:return[2]}}))}))},t.prototype.getButtonAdvancedSetting=function(t,e){return i(this,void 0,void 0,(function(){var n,i,r,c,u;return o(this,(function(o){switch(o.label){case 0:n='\n      <fetch top="1">\n        <entity name="esp_buttonadvancedsetting">\n          <attribute name="esp_asyncformnotification" />\n          <attribute name="esp_asyncformnotificationtext" />\n          <attribute name="esp_buttonadvancedsettingid" />\n          <attribute name="esp_confirmationdialogcancellabel" />\n          <attribute name="esp_confirmationdialogconfirmlabel" />\n          <attribute name="esp_confirmationdialogsubtitle" />\n          <attribute name="esp_confirmationdialogtext" />\n          <attribute name="esp_confirmationdialogtitle" />\n          <attribute name="esp_executionmode" />\n          <attribute name="esp_mainbuttonsetting" />\n          <attribute name="esp_modificationneededflag" />\n          <attribute name="esp_settingid" />\n          <attribute name="esp_settinglanguage" />\n          <attribute name="esp_showconfirmationdialog" />\n          <attribute name="esp_syncconfirmationboxconfirmlabel" />\n          <attribute name="esp_syncconfirmationboxredirectcancellabel" />\n          <attribute name="esp_syncconfirmationboxredirectconfirmlabel" />\n          <attribute name="esp_syncconfirmationboxredirectmode" />\n          <attribute name="esp_syncconfirmationboxredirectsubtitle" />\n          <attribute name="esp_syncconfirmationboxredirecttext" />\n          <attribute name="esp_syncconfirmationboxredirecttitle" />\n          <attribute name="esp_syncconfirmationboxtext" />\n          <attribute name="esp_syncconfirmationboxtitle" />\n          <attribute name="esp_syncconfirmationboxtype" />\n          <attribute name="esp_syncformnotification" />\n          <attribute name="esp_syncformnotificationtext" />\n          <attribute name="esp_syncrefreshform" />\n          <attribute name="esp_syncspinner" />\n          <attribute name="esp_syncspinnertext" />\n          <attribute name="esp_syncsuccessformnotification" />\n          <attribute name="esp_syncsuccessformnotificationtext" />\n          <filter>\n            <condition attribute="esp_mainbuttonsetting" operator="eq" value="'.concat(t,'" />\n          </filter>\n          <link-entity name="esp_language" from="esp_languageid" to="esp_settinglanguage" link-type="inner">\n            <filter>\n              <condition attribute="esp_lcid" operator="eq" value="').concat(e,'" />\n            </filter>\n          </link-entity>\n        </entity>\n      </fetch>\n    '),i="?fetchXml=".concat(encodeURIComponent(n)),r="".concat(Xrm.Utility.getGlobalContext().getClientUrl(),"/api/data/v9.1/esp_buttonadvancedsettings").concat(i),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.makeRequest("GET",r)];case 2:return[4,o.sent().json()];case 3:return c=o.sent(),u=c.value[0],this.buttonAdvancedSetting=u,[2,u];case 4:return o.sent(),a.ExceptionLowCodeButton.buttonAdvancedSettingNotFound(e),[2,null];case 5:return[2]}}))}))},t.prototype.getAllButtonAdvancedSetting=function(t){return i(this,void 0,void 0,(function(){var e,n,i;return o(this,(function(o){switch(o.label){case 0:e='\n        <fetch>\n          <entity name="esp_buttonadvancedsetting">\n            <attribute name="esp_asyncformnotification" />\n            <attribute name="esp_asyncformnotificationtext" />\n            <attribute name="esp_buttonadvancedsettingid" />\n            <attribute name="esp_confirmationdialogcancellabel" />\n            <attribute name="esp_confirmationdialogconfirmlabel" />\n            <attribute name="esp_confirmationdialogsubtitle" />\n            <attribute name="esp_confirmationdialogtext" />\n            <attribute name="esp_confirmationdialogtitle" />\n            <attribute name="esp_executionmode" />\n            <attribute name="esp_mainbuttonsetting" />\n            <attribute name="esp_modificationneededflag" />\n            <attribute name="esp_settingid" />\n            <attribute name="esp_settinglanguage" />\n            <attribute name="esp_showconfirmationdialog" />\n            <attribute name="esp_syncconfirmationboxconfirmlabel" />\n            <attribute name="esp_syncconfirmationboxredirectcancellabel" />\n            <attribute name="esp_syncconfirmationboxredirectconfirmlabel" />\n            <attribute name="esp_syncconfirmationboxredirectmode" />\n            <attribute name="esp_syncconfirmationboxredirectsubtitle" />\n            <attribute name="esp_syncconfirmationboxredirecttext" />\n            <attribute name="esp_syncconfirmationboxredirecttitle" />\n            <attribute name="esp_syncconfirmationboxtext" />\n            <attribute name="esp_syncconfirmationboxtitle" />\n            <attribute name="esp_syncconfirmationboxtype" />\n            <attribute name="esp_syncformnotification" />\n            <attribute name="esp_syncformnotificationtext" />\n            <attribute name="esp_syncrefreshform" />\n            <attribute name="esp_syncspinner" />\n            <attribute name="esp_syncspinnertext" />\n            <attribute name="esp_syncsuccessformnotification" />\n            <attribute name="esp_syncsuccessformnotificationtext" />\n            <filter>\n              <condition attribute="esp_mainbuttonsetting" operator="eq" value="'.concat(t,'" />\n            </filter>\n          </entity>\n        </fetch>\n      '),n="?fetchXml=".concat(encodeURIComponent(e)),i="".concat(Xrm.Utility.getGlobalContext().getClientUrl(),"/api/data/v9.1/esp_buttonadvancedsettings").concat(n),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.makeRequest("GET",i)];case 2:return[4,o.sent().json()];case 3:return[2,o.sent().value];case 4:return o.sent(),a.ExceptionLowCodeButton.displayGenericErrorNotification("Error","Error while fetching the advanced button settings except the given LCID. Function name: getAllButtonAdvancedSettingExceptTheGivenLCID"),[2,[]];case 5:return[2]}}))}))},t.prototype.getAllButtonAdvancedSettingExceptTheGivenLCID=function(t){return i(this,arguments,void 0,(function(t,e){var n,i,r;return void 0===e&&(e=""),o(this,(function(o){switch(o.label){case 0:n='\n      <fetch>\n        <entity name="esp_buttonadvancedsetting">\n          <attribute name="esp_asyncformnotification" />\n          <attribute name="esp_asyncformnotificationtext" />\n          <attribute name="esp_buttonadvancedsettingid" />\n          <attribute name="esp_confirmationdialogcancellabel" />\n          <attribute name="esp_confirmationdialogconfirmlabel" />\n          <attribute name="esp_confirmationdialogsubtitle" />\n          <attribute name="esp_confirmationdialogtext" />\n          <attribute name="esp_confirmationdialogtitle" />\n          <attribute name="esp_executionmode" />\n          <attribute name="esp_mainbuttonsetting" />\n          <attribute name="esp_modificationneededflag" />\n          <attribute name="esp_settingid" />\n          <attribute name="esp_settinglanguage" />\n          <attribute name="esp_showconfirmationdialog" />\n          <attribute name="esp_syncconfirmationboxconfirmlabel" />\n          <attribute name="esp_syncconfirmationboxredirectcancellabel" />\n          <attribute name="esp_syncconfirmationboxredirectconfirmlabel" />\n          <attribute name="esp_syncconfirmationboxredirectmode" />\n          <attribute name="esp_syncconfirmationboxredirectsubtitle" />\n          <attribute name="esp_syncconfirmationboxredirecttext" />\n          <attribute name="esp_syncconfirmationboxredirecttitle" />\n          <attribute name="esp_syncconfirmationboxtext" />\n          <attribute name="esp_syncconfirmationboxtitle" />\n          <attribute name="esp_syncconfirmationboxtype" />\n          <attribute name="esp_syncformnotification" />\n          <attribute name="esp_syncformnotificationtext" />\n          <attribute name="esp_syncrefreshform" />\n          <attribute name="esp_syncspinner" />\n          <attribute name="esp_syncspinnertext" />\n          <attribute name="esp_syncsuccessformnotification" />\n          <attribute name="esp_syncsuccessformnotificationtext" />\n          <filter>\n            <condition attribute="esp_mainbuttonsetting" operator="eq" value="'.concat(t,'" />\n            <condition attribute="esp_settinglanguage" operator="ne" value="').concat(e,'" />\n          </filter>\n        </entity>\n      </fetch>\n    '),i="?fetchXml=".concat(encodeURIComponent(n)),r="".concat(Xrm.Utility.getGlobalContext().getClientUrl(),"/api/data/v9.1/esp_buttonadvancedsettings").concat(i),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.makeRequest("GET",r)];case 2:return[4,o.sent().json()];case 3:return[2,o.sent().value];case 4:return o.sent(),a.ExceptionLowCodeButton.displayGenericErrorNotification("Error","Error while fetching the advanced button settings except the given LCID. Function name: getAllButtonAdvancedSettingExceptTheGivenLCID"),[2,[]];case 5:return[2]}}))}))},t.prototype.getFilterLookupForLanguage=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,this.getAllButtonAdvancedSettingExceptTheGivenLCID(t,e)];case 1:return[2,"<filter type='and'>"+n.sent().map((function(t){return'<condition attribute="esp_languageid" operator="ne" value="'.concat(t._esp_settinglanguage_value,'" />')})).join("")+"</filter>"]}}))}))},t.prototype.initializeSettings=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this.getButtonSetting(t)];case 1:return(e=n.sent())?[4,this.getButtonAdvancedSetting(e.esp_buttonsettingid,this.getLanguageCode())]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t}();e.BaseHelper=r},419:function(t,e,n){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},i.apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{u(i.next(t))}catch(t){a(t)}}function c(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}u((i=i.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=c(0),r.throw=c(1),r.return=c(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(a=0)),a;)try{if(n=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],i=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.ButtonSetting=void 0;var r=n(97),c=function(){function t(){}return t.onLoad=function(t){return o(this,void 0,void 0,(function(){var e,n;return a(this,(function(i){switch(i.label){case 0:return e=null==t?void 0:t.getFormContext(),[4,this.checkAdvancedButtonSettings(t)];case 1:return i.sent(),e.getControl("esp_examplepayload").setVisible(null===(n=e.getAttribute("esp_showexamplepayload"))||void 0===n?void 0:n.getValue()),[2]}}))}))},t.onChange=function(t){return o(this,void 0,void 0,(function(){var e,n,i,o;return a(this,(function(a){switch(a.label){case 0:return(e=null==t?void 0:t.getFormContext()).getControl("esp_examplepayload").setVisible(null===(n=e.getAttribute("esp_showexamplepayload"))||void 0===n?void 0:n.getValue()),(null===(i=e.getAttribute("esp_showexamplepayload"))||void 0===i?void 0:i.getValue())?(null===(o=e.getAttribute("esp_examplepayload"))||void 0===o||o.setValue(this.getFormattedExamplePayload(e)),e.data.getIsDirty()&&2===e.ui.getFormType()?[4,e.data.save()]:[3,2]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},t.checkAdvancedButtonSettings=function(t){return o(this,void 0,void 0,(function(){var e,n,i,o,c;return a(this,(function(a){switch(a.label){case 0:return e=null==t?void 0:t.getFormContext(),n=new r.BaseHelper,i=e.data.entity.getEntityReference(),[4,n.getAllButtonAdvancedSetting(i.id)];case 1:return o=a.sent(),c=!1,o.forEach((function(t){t.esp_modificationneededflag&&(c=!0)})),c&&e.ui.setFormNotification("Some of the advanced button settings need to be properly configured. Please review the records using the 'Advanced Button Settings with Errors' subgrid.","WARNING","ModificationNeeded"),e.getControl("advanced_settings_error").setVisible(c),[2]}}))}))},t.getFormattedExamplePayload=function(t){var e,n,o,a,r,c,u,s,l={};return(null===(e=t.getAttribute("esp_includecallinguseridinpayload"))||void 0===e?void 0:e.getValue())&&(l=i(i({},l),{userId:"UserId"})),(null===(n=t.getAttribute("esp_includeentitylogicalnameinpayload"))||void 0===n?void 0:n.getValue())&&(l=i(i({},l),{entityLogicalSingularName:"account",entityLogicalPluralName:"accounts"}),789620002===(null===(o=t.getAttribute("esp_buttonlocation"))||void 0===o?void 0:o.getValue())&&(l=i(i({},l),{parentEntityLogicalName:"contact",parentEntityLogicalPluralName:"contacts"}))),(null===(a=t.getAttribute("esp_includerecordidinpayload"))||void 0===a?void 0:a.getValue())&&(78962e4===(null===(r=t.getAttribute("esp_buttonlocation"))||void 0===r?void 0:r.getValue())&&(l=i(i({},l),{recordId:"Guid"})),789620001!==(null===(c=t.getAttribute("esp_buttonlocation"))||void 0===c?void 0:c.getValue())&&789620002!==(null===(u=t.getAttribute("esp_buttonlocation"))||void 0===u?void 0:u.getValue())||(l=i(i({},l),{recordIds:["Guid1","Guid2"]}),789620002===(null===(s=t.getAttribute("esp_buttonlocation"))||void 0===s?void 0:s.getValue())&&(l=i(i({},l),{parentRecordId:"Guid"})))),JSON.stringify(l,null,2)},t}();e.ButtonSetting=c},842:function(t,e){var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{u(i.next(t))}catch(t){a(t)}}function c(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}u((i=i.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=c(0),r.throw=c(1),r.return=c(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(a=0)),a;)try{if(n=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],i=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.ExceptionLowCodeButton=void 0;var o=function(){function t(){}return t.buttonSettingNotFound=function(t){return n(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e={text:"Button setting not found: ".concat(t),title:"Button Setting Not Found"},[4,Xrm.Navigation.openAlertDialog(e)];case 1:return n.sent(),[2]}}))}))},t.buttonAdvancedSettingNotFound=function(t){return n(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e={text:"Button advanced setting not found for the LCID ".concat(t),title:"Button Advanced Setting Not Found"},[4,Xrm.Navigation.openAlertDialog(e)];case 1:return n.sent(),[2]}}))}))},t.displayGenericErrorNotification=function(t,e){return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return n={text:e,title:t},[4,Xrm.Navigation.openAlertDialog(n)];case 1:return i.sent(),[2]}}))}))},t}();e.ExceptionLowCodeButton=o}},e={},n=function n(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,n),a.exports}(419);LCB=n})();